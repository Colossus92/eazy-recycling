server:
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/plain
    min-response-size: 1024

spring:
  application.name: eazy-recycling-service
  datasource:
    # Use Supabase Session Pooler (IPv4) - NOT direct connection (IPv6 only)
    # Format: jdbc:postgresql://aws-0-eu-west-1.pooler.supabase.com:5432/postgres
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME:}
    password: ${SPRING_DATASOURCE_PASSWORD:}
    driver-class-name: org.postgresql.Driver
    hikari:
      # Conservative pool sizing for Supabase (Pool Size: 15)
      # During rolling deployment: 2 instances Ã— 6 = 12 connections + 3 headroom
      maximum-pool-size: 6
      minimum-idle: 2
      # Connection management
      connection-timeout: 30000 # 30 seconds
      idle-timeout: 600000 # 10 minutes
      max-lifetime: 1800000 # 30 minutes
      # Health check to detect stale connections
      connection-test-query: SELECT 1
      # Faster detection of connection issues
      validation-timeout: 5000 # 5 seconds
      # Graceful shutdown during rolling deployment
      leak-detection-threshold: 60000 # 60 seconds
  jpa:
    open-in-view: true
    properties:
      jakarta.persistence:
        schema-generation.scripts:
          action: none
          create-target: create.sql
          create-source: metadata
          drop-target: drop.sql
          drop-source: metadata
      hibernate:
        hbm2ddl.auto: none
        show_sql: false
        format_sql: true
        schema-generation.scripts.action: create
        schema-generation.scripts.create-target: schema.sql
        jdbc.time_zone: UTC
  ssl:
    bundle:
      jks:
        amice-client:
          keystore:
            location: ${AMICE_CERTIFICATE_PATH:classpath:certificates/test-amice.pfx}
            password: ${AMICE_PASSWORD:}
            type: PKCS12

# Supabase Configuration
supabase:
  api:
    url: ${SUPABASE_API_URL:}
    secret: ${SUPABASE_API_SECRET:}
    publishable: ${SUPABASE_API_PUBLISHABLE:}
    jwt-issuer: ${SUPABASE_API_JWT_ISSUER:}

# CORS Configuration
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:https://*.eazysoftware.nl,https://*.eazyrecycling.nl}

# Frontend URL for OAuth redirects
frontend:
  url: ${FRONTEND_URL:http://localhost:5173}

pricing-app:
  base-url: ${PRICING_APP_BASE_URL:}
  bearer-token: ${PRICING_APP_BEARER_TOKEN:}

springdoc:
  api-docs:
    enabled: false

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    tags:
      application: ${spring.application.name}

amice:
  enabled: ${AMICE_ENABLED:true}
  url: ${AMICE_URL:}
  username: ${AMICE_USERNAME:}
  password: ${AMICE_PASSWORD:}

exact:
  oauth:
    client-id: ${EXACT_CLIENT_ID:}
    client-secret: ${EXACT_CLIENT_SECRET:}
    redirect-uri: ${EXACT_REDIRECT_URI:http://localhost:8080/api/admin/exact/callback}
    authorization-endpoint: https://start.exactonline.nl/api/oauth2/auth
    token-endpoint: https://start.exactonline.nl/api/oauth2/token
  division: ${EXACT_DIVISION:}

# Token encryption - key must be Base64-encoded 32-byte (256-bit) AES key
# Generate with: openssl rand -base64 32
security:
  encryption:
    token-encryption-key: ${TOKEN_ENCRYPTION_KEY:}

tenant:
  purchase-financial-email: ${PURCHASE_FINANCIAL_EMAIL:}
  sales-financial-email: ${SALES_FINANCIAL_EMAIL:}
logging:
  structured:
    format:
      console: logstash
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS}{Europe/Amsterdam} [%thread] %-5level %logger{36} - %msg%n"
  level:
    root: info

jobrunr:
  database:
    tablePrefix: jobrunr.
    skip-create: true
  dashboard:
    enabled: false
  jobs:
    metrics:
      enabled: true
  background-job-server:
    enabled: true
    worker-count: 1
